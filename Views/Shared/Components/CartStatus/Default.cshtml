@model partner_aluro.ViewModels.CartStatusModel

@using Microsoft.AspNetCore.Identity
@using partner_aluro.ViewComponents;
@using partner_aluro.Models

@inject Cart _cart

@if(Model.Cart.CartItems.Count > 0)
{
    <div class="row">
        <div class="col">
            
        </div>
        <div class="col">
            Produkt
        </div>
        <div class="col">
            Ilość
        </div>
        <div class="col">
            Usuń
        </div>
    </div>
    @foreach (var item in Model.Cart.CartItems)
    {
    <div class="row">
        @{

                var Cena_brutto = (decimal)item.Product.CenaProduktu * (decimal)partner_aluro.Core.Constants.Vat;
                var CenaJednostkowa_netto = item.Product.CenaProduktu;
                var CenaJednostkowa_brutto = (decimal)Cena_brutto;

                if (partner_aluro.Core.Constants.Rabat >= 0)
                {
                    CenaJednostkowa_netto = item.Product.CenaProduktu * (1 - (partner_aluro.Core.Constants.Rabat / 100));
                    CenaJednostkowa_brutto = (decimal)Cena_brutto * (1 - (partner_aluro.Core.Constants.Rabat / 100));
                }

                var ProductTotal = CenaJednostkowa_brutto * item.Quantity;


        }
        <div class="col">
            <img src="~/images/produkty/@item.Product.Symbol/@item.Product.ImageUrl" style="height: 4em">
        </div>
        <div class="col">
            @item.Product.Symbol <br>
            <a class="text-black" asp-controller="Product" asp-action="Details" asp-route-id="@item.Product.ProductId">@item.Product.Name</a><br>
                @CenaJednostkowa_brutto.ToString("C")
        </div>
        <div class="col">

                <a onclick="ReduceQuantity(@item.Product.ProductId)"><i class="fa-solid fa-minus"></i></a>
                
            @item.Quantity

                <a onclick="IncreaseQuantity(@item.Product.ProductId)"><i class="fa-solid fa-plus"></i></a>
            </div>
        <div class="col">

                <a onclick="RemoveFromCart(@item.Product.ProductId)" class="text-danger"><i class="fa-solid fa-xmark"></i></a>
        </div>
    </div>
    }
    <div class="row">
        <div class="col">
            Suma: <strong>@Model.Cart.GetCartTotalBrutto().ToString("C")</strong>
        </div>
    </div>
    <div class="row">
        <div class="col text-center">

        <a class="btn btn-success" asp-controller="Cart" asp-action="ZlozZamowienie">Złóż zamówienie</a>

        </div>
    </div>


 }else
{
    <h3 class="text-center">Koszyk jest pusty</h3>
}